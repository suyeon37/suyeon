<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>나무 심기 게임</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;

      function TreePlantingGame() {
        const [score, setScore] = useState(0);
        const [water, setWater] = useState(100);
        const [sunlight, setSunlight] = useState(100);
        const [trees, setTrees] = useState([]);
        const [selectedTool, setSelectedTool] = useState('plant');
        const [gameTime, setGameTime] = useState(0);

        const GRID_SIZE = 8;

        useEffect(() => {
          const timer = setInterval(() => {
            setGameTime(t => t + 1);
            setWater(w => Math.max(0, w - 0.5));
            setSunlight(s => Math.max(0, s - 0.3));
            setTrees(prevTrees =>
              prevTrees.map(tree => {
                if (tree.stage < 3 && water > 10 && sunlight > 10) {
                  const newGrowth = tree.growth + 1;
                  if (newGrowth >= 100) {
                    return { ...tree, stage: tree.stage + 1, growth: 0 };
                  }
                  return { ...tree, growth: newGrowth };
                }
                return tree;
              })
            );
          }, 100);
          return () => clearInterval(timer);
        }, [water, sunlight]);

        const handleCellClick = (row, col) => {
          const cellKey = `${row}-${col}`;
          const existingTree = trees.find(t => t.position === cellKey);

          if (selectedTool === 'plant' && !existingTree && water >= 20) {
            setTrees([...trees, { position: cellKey, stage: 0, growth: 0, planted: gameTime }]);
            setWater(w => w - 20);
          } else if (selectedTool === 'harvest' && existingTree && existingTree.stage === 3) {
            setTrees(trees.filter(t => t.position !== cellKey));
            setScore(s => s + 100);
            setWater(w => Math.min(100, w + 10));
            setSunlight(s => Math.min(100, s + 10));
          }
        };

        const addWater = () => setWater(w => Math.min(100, w + 30));
        const addSunlight = () => setSunlight(s => Math.min(100, s + 30));

        const TreeSprite = ({ stage }) => {
          if (stage === 0) {
            return (
              <div className="relative w-full h-full flex items-end justify-center pb-2">
                <div className="w-2 h-3 bg-green-400 rounded-t-full"></div>
                <div className="absolute bottom-1 w-1 h-2 bg-green-600"></div>
              </div>
            );
          }
          if (stage === 1) {
            return (
              <div className="relative w-full h-full flex items-end justify-center pb-1">
                <div className="w-1 h-4 bg-amber-700"></div>
                <div className="absolute bottom-3 left-1/2 -translate-x-1/2">
                  <div className="w-4 h-4 bg-green-500 rounded-full"></div>
                  <div className="absolute top-0 -left-1 w-2 h-2 bg-green-500 rounded-full"></div>
                  <div className="absolute top-0 -right-1 w-2 h-2 bg-green-500 rounded-full"></div>
                </div>
              </div>
            );
          }
          if (stage === 2) {
            return (
              <div className="relative w-full h-full flex items-end justify-center">
                <div className="w-2 h-6 bg-amber-800"></div>
                <div className="absolute bottom-4 left-1/2 -translate-x-1/2">
                  <div className="w-6 h-6 bg-green-600 rounded-full"></div>
                  <div className="absolute top-0 -left-2 w-4 h-4 bg-green-600 rounded-full"></div>
                  <div className="absolute top-0 -right-2 w-4 h-4 bg-green-600 rounded-full"></div>
                  <div className="absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-green-600 rounded-full"></div>
                </div>
              </div>
            );
          }
          return (
            <div className="relative w-full h-full flex items-end justify-center">
              <div className="w-2 h-8 bg-amber-900"></div>
              <div className="absolute bottom-5 left-1/2 -translate-x-1/2">
                <div className="w-8 h-8 bg-green-700 rounded-full"></div>
                <div className="absolute top-0 -left-2 w-5 h-5 bg-green-700 rounded-full"></div>
                <div className="absolute top-0 -right-2 w-5 h-5 bg-green-700 rounded-full"></div>
                <div className="absolute -top-3 left-1/2 -translate-x-1/2 w-5 h-5 bg-green-700 rounded-full"></div>
                <div className="absolute top-2 -left-3 w-3 h-3 bg-green-700 rounded-full"></div>
                <div className="absolute top-2 -right-3 w-3 h-3 bg-green-700 rounded-full"></div>
              </div>
            </div>
          );
        };

        return (
          <div className="w-full min-h-screen bg-gradient-to-b from-sky-200 to-green-100 p-4 overflow-auto">
            <div className="max-w-4xl mx-auto">
              <div className="bg-white rounded-lg shadow-lg p-4 mb-4">
                <h1 className="text-3xl font-bold text-green-700 text-center mb-4">나무 심기 게임</h1>

                <div className="grid grid-cols-3 gap-4 mb-4">
                  <div className="bg-yellow-100 rounded p-3 text-center">
                    <div className="text-2xl font-bold text-yellow-700">{score}</div>
                    <div className="text-sm text-yellow-600">점수</div>
                  </div>
                  <div className="bg-blue-100 rounded p-3">
                    <div className="flex items-center justify-between mb-1">
                      <span className="text-blue-600" role="img" aria-label="rain">☔</span>
                      <span className="text-sm font-semibold">{Math.round(water)}%</span>
                    </div>
                    <div className="w-full bg-blue-200 rounded-full h-2">
                      <div className="bg-blue-500 h-2 rounded-full transition-all" style={{ width: `${water}%` }}></div>
                    </div>
                  </div>
                  <div className="bg-orange-100 rounded p-3">
                    <div className="flex items-center justify-between mb-1">
                      <span className="text-orange-600" role="img" aria-label="sun">☀️</span>
                      <span className="text-sm font-semibold">{Math.round(sunlight)}%</span>
                    </div>
                    <div className="w-full bg-orange-200 rounded-full h-2">
                      <div className="bg-orange-500 h-2 rounded-full transition-all" style={{ width: `${sunlight}%` }}></div>
                    </div>
                  </div>
                </div>

                <div className="flex gap-2 mb-4">
                  <button
                    onClick={() => setSelectedTool('plant')}
                    className={`flex-1 py-3 px-4 rounded-lg font-semibold transition-all ${selectedTool === 'plant' ? 'bg-green-500 text-white shadow-lg' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}
                  >
                    심기 (물 -20)
                  </button>
                  <button
                    onClick={() => setSelectedTool('harvest')}
                    className={`flex-1 py-3 px-4 rounded-lg font-semibold transition-all ${selectedTool === 'harvest' ? 'bg-amber-500 text-white shadow-lg' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}
                  >
                    수확
                  </button>
                </div>

                <div className="flex gap-2">
                  <button onClick={addWater} className="flex-1 py-2 px-4 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all">물 추가 (+30)</button>
                  <button onClick={addSunlight} className="flex-1 py-2 px-4 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-all">햇빛 추가 (+30)</button>
                </div>
              </div>

              <div className="bg-white rounded-lg shadow-lg p-4">
                <div className="grid gap-1" style={{ gridTemplateColumns: `repeat(${GRID_SIZE}, 1fr)` }}>
                  {Array.from({ length: GRID_SIZE * GRID_SIZE }).map((_, index) => {
                    const row = Math.floor(index / GRID_SIZE);
                    const col = index % GRID_SIZE;
                    const cellKey = `${row}-${col}`;
                    const tree = trees.find(t => t.position === cellKey);
                    return (
                      <button
                        key={cellKey}
                        onClick={() => handleCellClick(row, col)}
                        className={`${tree ? 'bg-green-200 hover:bg-green-300' : 'bg-amber-100 hover:bg-amber-200'} aspect-square rounded-lg transition-all flex items-center justify-center cursor-pointer relative overflow-hidden`}
                      >
                        {tree && <TreeSprite stage={tree.stage} />}
                      </button>
                    );
                  })}
                </div>
              </div>

              <div className="bg-white rounded-lg shadow-lg p-4 mt-4">
                <h2 className="font-bold text-lg mb-2">게임 방법</h2>
                <ul className="text-sm space-y-1 text-gray-700">
                  <li>• 심기 도구로 빈 땅을 클릭하여 나무를 심으세요</li>
                  <li>• 물과 햇빛이 충분하면 나무가 자동으로 자랍니다</li>
                  <li>• 새싹 → 작은 나무 → 중간 나무 → 큰 나무 순서로 성장합니다</li>
                  <li>• 수확 도구로 다 자란 나무를 클릭하여 수확하세요</li>
                  <li>• 수확하면 100점과 자원을 얻습니다!</li>
                </ul>
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<TreePlantingGame />);
    </script>
  </body>
  </html>