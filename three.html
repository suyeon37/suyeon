import React, { useEffect, useRef, useState } from 'react';

export default function Pola3DInteraction() {
  const canvasRef = useRef(null);
  const [mousePosition, setMousePosition] = useState({ x: 0, y: 0 });
  const [isHovering, setIsHovering] = useState(false);
  const animationRef = useRef(null);
  const particlesRef = useRef([]);

  useEffect(() => {
    const canvas = canvasRef.current;
    const ctx = canvas.getContext('2d');
    
    // Set canvas size
    const resizeCanvas = () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    };
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // Initialize particles for floating effect
    const initParticles = () => {
      particlesRef.current = [];
      for (let i = 0; i < 50; i++) {
        particlesRef.current.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          size: Math.random() * 3 + 1,
          speedX: Math.random() * 0.5 - 0.25,
          speedY: Math.random() * 0.5 - 0.25,
          opacity: Math.random() * 0.5 + 0.2
        });
      }
    };
    initParticles();

    // Animation loop
    const animate = () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw gradient background
      const gradient = ctx.createRadialGradient(
        canvas.width / 2, canvas.height / 2, 0,
        canvas.width / 2, canvas.height / 2, canvas.width / 2
      );
      gradient.addColorStop(0, '#fff5f8');
      gradient.addColorStop(0.5, '#ffe8f0');
      gradient.addColorStop(1, '#ffd4e5');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Draw particles
      particlesRef.current.forEach(particle => {
        ctx.beginPath();
        ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(255, 182, 193, ${particle.opacity})`;
        ctx.fill();

        // Update particle position
        particle.x += particle.speedX;
        particle.y += particle.speedY;

        // Wrap around screen
        if (particle.x < 0) particle.x = canvas.width;
        if (particle.x > canvas.width) particle.x = 0;
        if (particle.y < 0) particle.y = canvas.height;
        if (particle.y > canvas.height) particle.y = 0;
      });

      animationRef.current = requestAnimationFrame(animate);
    };
    animate();

    return () => {
      window.removeEventListener('resize', resizeCanvas);
      if (animationRef.current) {
        cancelAnimationFrame(animationRef.current);
      }
    };
  }, []);

  const handleMouseMove = (e) => {
    const rect = canvasRef.current.getBoundingClientRect();
    setMousePosition({
      x: e.clientX - rect.left,
      y: e.clientY - rect.top
    });
  };

  return (
    <div className="relative w-full h-screen overflow-hidden bg-gradient-to-br from-pink-50 via-rose-50 to-pink-100">
      {/* Canvas Background */}
      <canvas
        ref={canvasRef}
        className="absolute inset-0"
        onMouseMove={handleMouseMove}
      />

      {/* 3D Interactive Elements */}
      <div className="absolute inset-0 flex items-center justify-center">
        {/* Center Sphere Group */}
        <div 
          className="relative"
          style={{
            transform: `translate(${(mousePosition.x - window.innerWidth / 2) * 0.02}px, ${(mousePosition.y - window.innerHeight / 2) * 0.02}px)`,
            transition: 'transform 0.1s ease-out'
          }}
        >
          {/* Main Large Sphere */}
          <div 
            className="relative w-64 h-64 rounded-full transition-all duration-500"
            style={{
              background: 'linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #feada6 100%)',
              boxShadow: '0 20px 60px rgba(255, 154, 158, 0.4), inset 0 -10px 30px rgba(255, 255, 255, 0.3)',
              transform: isHovering ? 'scale(1.1) rotate(5deg)' : 'scale(1) rotate(0deg)'
            }}
            onMouseEnter={() => setIsHovering(true)}
            onMouseLeave={() => setIsHovering(false)}
          >
            {/* Glossy highlight */}
            <div 
              className="absolute top-8 left-12 w-24 h-24 rounded-full"
              style={{
                background: 'radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8), transparent)',
                filter: 'blur(20px)'
              }}
            />
          </div>

          {/* Small Floating Spheres */}
          {[...Array(5)].map((_, i) => (
            <div
              key={i}
              className="absolute rounded-full"
              style={{
                width: `${40 + i * 15}px`,
                height: `${40 + i * 15}px`,
                background: `linear-gradient(135deg, rgba(255, 182, 193, 0.6), rgba(255, 228, 225, 0.4))`,
                boxShadow: '0 10px 30px rgba(255, 182, 193, 0.3)',
                top: `${Math.sin(i * 1.2) * 150 + 50}px`,
                left: `${Math.cos(i * 1.2) * 150 + 50}px`,
                transform: `translate(${Math.sin(Date.now() * 0.001 + i) * 20}px, ${Math.cos(Date.now() * 0.001 + i) * 20}px)`,
                animation: `float${i} ${4 + i}s ease-in-out infinite`,
              }}
            >
              <div 
                className="absolute top-2 left-3 w-8 h-8 rounded-full"
                style={{
                  background: 'radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.7), transparent)',
                  filter: 'blur(8px)'
                }}
              />
            </div>
          ))}
        </div>

        {/* Orbiting Elements */}
        {[...Array(8)].map((_, i) => (
          <div
            key={`orbit-${i}`}
            className="absolute rounded-full"
            style={{
              width: '20px',
              height: '20px',
              background: 'radial-gradient(circle, rgba(255, 192, 203, 0.8), rgba(255, 182, 193, 0.4))',
              boxShadow: '0 4px 15px rgba(255, 192, 203, 0.5)',
              animation: `orbit${i % 4} ${8 + i * 0.5}s linear infinite`,
              transformOrigin: 'center',
            }}
          />
        ))}
      </div>

      {/* Floating Elements in Background */}
      <div className="absolute inset-0 pointer-events-none">
        {[...Array(20)].map((_, i) => (
          <div
            key={`bg-${i}`}
            className="absolute rounded-full opacity-20"
            style={{
              width: `${10 + Math.random() * 30}px`,
              height: `${10 + Math.random() * 30}px`,
              background: 'linear-gradient(135deg, #ffb6c1, #ffc0cb)',
              left: `${Math.random() * 100}%`,
              top: `${Math.random() * 100}%`,
              animation: `bgFloat ${10 + Math.random() * 10}s ease-in-out infinite`,
              animationDelay: `${Math.random() * 5}s`
            }}
          />
        ))}
      </div>

      {/* CSS Animations */}
      <style jsx>{`
        @keyframes float0 {
          0%, 100% { transform: translate(0, 0) rotate(0deg); }
          50% { transform: translate(20px, -20px) rotate(180deg); }
        }
        @keyframes float1 {
          0%, 100% { transform: translate(0, 0) rotate(0deg); }
          50% { transform: translate(-15px, 25px) rotate(-180deg); }
        }
        @keyframes float2 {
          0%, 100% { transform: translate(0, 0) rotate(0deg); }
          50% { transform: translate(25px, 15px) rotate(180deg); }
        }
        @keyframes float3 {
          0%, 100% { transform: translate(0, 0) rotate(0deg); }
          50% { transform: translate(-20px, -15px) rotate(-180deg); }
        }
        @keyframes float4 {
          0%, 100% { transform: translate(0, 0) rotate(0deg); }
          50% { transform: translate(15px, -25px) rotate(180deg); }
        }
        @keyframes orbit0 {
          0% { transform: translate(-50%, -50%) rotate(0deg) translateX(200px) rotate(0deg); }
          100% { transform: translate(-50%, -50%) rotate(360deg) translateX(200px) rotate(-360deg); }
        }
        @keyframes orbit1 {
          0% { transform: translate(-50%, -50%) rotate(0deg) translateX(250px) rotate(0deg); }
          100% { transform: translate(-50%, -50%) rotate(360deg) translateX(250px) rotate(-360deg); }
        }
        @keyframes orbit2 {
          0% { transform: translate(-50%, -50%) rotate(0deg) translateX(300px) rotate(0deg); }
          100% { transform: translate(-50%, -50%) rotate(360deg) translateX(300px) rotate(-360deg); }
        }
        @keyframes orbit3 {
          0% { transform: translate(-50%, -50%) rotate(0deg) translateX(350px) rotate(0deg); }
          100% { transform: translate(-50%, -50%) rotate(360deg) translateX(350px) rotate(-360deg); }
        }
        @keyframes bgFloat {
          0%, 100% { transform: translateY(0) translateX(0); opacity: 0.1; }
          50% { transform: translateY(-30px) translateX(20px); opacity: 0.3; }
        }
      `}</style>
    </div>
  );
}